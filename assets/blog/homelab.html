<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homelab Docker Stack ‚Äì Turning an Old Laptop into a Cloudflare-Protected Lab ‚Äì Anass Assim</title>
    <link rel="icon" type="image/x-icon" href="/assets/img/anass1.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out',
                        'slide-up': 'slideUp 0.8s ease-out',
                        'scale-in': 'scaleIn 0.5s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        scaleIn: {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' }
                        },
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle at top left, #e0f2fe, #ffffff 55%);
        }

        .nav-link {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-link::before {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #0ea5e9, #3b82f6);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(-50%);
        }

        .nav-link:hover::before {
            width: 100%;
        }

        .nav-link:hover {
            color: #0ea5e9;
            transform: translateY(-2px);
        }

        .scroll-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 4px;
            background: linear-gradient(90deg, #0ea5e9, #3b82f6, #8b5cf6);
            z-index: 1000;
            transition: width 0.1s ease;
        }

        .article-container {
            max-width: 960px;
        }

        .article-body p {
            margin-bottom: 1rem;
        }

        .article-body h2 {
            margin-top: 2.5rem;
            margin-bottom: 0.75rem;
        }

        .article-body h3 {
            margin-top: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .article-body code {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.85em;
            background: rgba(15,23,42,0.06);
            padding: 0.15rem 0.35rem;
            border-radius: 9999px;
        }

        pre.code-block {
            background: #020617;
            color: #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.25rem 1rem;
            overflow-x: auto;
            font-size: 0.85rem;
            border: 1px solid rgba(148,163,184,0.3);
        }

        pre.code-block code {
            background: transparent;
            padding: 0;
            border-radius: 0;
        }

        .toc-link {
            font-size: 0.85rem;
            color: #64748b;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0;
        }

        .toc-link.active {
            color: #0ea5e9;
            font-weight: 600;
        }

        .badge-pill {
            border-radius: 9999px;
        }

        .article-hero {
            background: radial-gradient(circle at top left, rgba(56,189,248,0.15), transparent 55%),
                        radial-gradient(circle at bottom right, rgba(129,140,248,0.18), transparent 55%);
        }

        .magnetic {
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ---------- OPTIONAL IMAGE BLOCK ---------- */
        .article-image-wrapper {
            margin: 1.75rem 0;
            border-radius: 1rem;
            overflow: hidden;
            border: 1px solid rgba(148,163,184,0.5);
            background:
                radial-gradient(circle at top left, rgba(56,189,248,0.10), transparent 60%),
                #0f172a;
        }

        .article-image-wrapper img {
            display: block;
            width: 100%;
            height: auto;
            object-fit: cover;
        }

        .article-image-caption {
            font-size: 0.78rem;
            line-height: 1.4;
            padding: 0.65rem 0.9rem;
            background: rgba(15,23,42,0.94);
            color: #e5e7eb;
            border-top: 1px solid rgba(148,163,184,0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.75rem;
        }

        .article-image-caption span {
            opacity: 0.85;
        }

        .article-image-caption small {
            font-size: 0.7rem;
            color: #9ca3af;
            white-space: nowrap;
        }

        /* ---------- MUSIC PLAYER (SIDEBAR) ---------- */
        .reading-music-card {
            background:
                radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 55%),
                #020617;
            border-radius: 0.9rem;
            border: 1px solid rgba(148,163,184,0.5);
            box-shadow: 0 16px 35px rgba(15,23,42,0.7);
        }

        .player-progress-track {
            position: relative;
            height: 5px;
            border-radius: 9999px;
            background: rgba(148,163,184,0.35);
            cursor: pointer;
            overflow: hidden;
        }

        .player-progress-fill {
            position: absolute;
            inset: 0;
            width: 0%;
            border-radius: inherit;
            background: linear-gradient(90deg, #0ea5e9, #3b82f6, #8b5cf6);
        }

        .player-btn {
            transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
        }

        .player-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 22px rgba(15,23,42,0.65);
        }

        .player-btn:active {
            transform: translateY(0);
            box-shadow: none;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 overflow-x-hidden">
    <div class="scroll-indicator"></div>
    <header class="fixed top-0 w-full z-50 transition-all duration-300 bg-white/80 backdrop-blur-md border-b border-white/20" id="navbar">
        <nav class="max-w-6xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <a href="/index.html#home" class="text-2xl font-bold text-sky-600 hover:scale-105 transition-transform duration-300">
                    Anass Assim
                </a>
                
                <div class="hidden md:flex space-x-8">
                    <a href="/index.html" class="nav-link text-slate-700 font-medium">Home</a>
                    <a href="/index.html#skills" class="nav-link text-slate-700 font-medium">Skills</a>
                    <a href="/index.html#experience" class="nav-link text-slate-700 font-medium">Experience</a>
                    <a href="/index.html#projects" class="nav-link text-slate-700 font-medium">Projects</a>
                    <a href="/index.html#contact" class="nav-link text-slate-700 font-medium">Contact</a>
                    <a href="/blog.html" class="nav-link text-sky-600 font-semibold">Blog</a>
                    <a href="/AnassOs.html" class="nav-link text-slate-700 font-medium">AnassOS</a>
                    <a href="/Terminal.html" class="nav-link text-slate-700 font-medium">Terminal</a>
                </div>

                <button id="mobile-menu-button"
                        type="button"
                        class="md:hidden text-slate-700 hover:text-sky-600 transition-colors"
                        aria-controls="mobile-menu"
                        aria-expanded="false"
                        aria-label="Open main menu">
                    <i class="fas fa-bars text-2xl" aria-hidden="true"></i>
                </button>
            </div>

            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4 border-t border-slate-200">
                <div class="flex flex-col space-y-2 pt-4">
                    <a href="../index.html#home" class="text-slate-700 hover:text-sky-600 py-2 px-4 rounded-lg hover:bg-sky-50 transition-all">Home</a>
                    <a href="../index.html#skills" class="text-slate-700 hover:text-sky-600 py-2 px-4 rounded-lg hover:bg-sky-50 transition-all">Skills</a>
                    <a href="../index.html#experience" class="text-slate-700 hover:text-sky-600 py-2 px-4 rounded-lg hover:bg-sky-50 transition-all">Experience</a>
                    <a href="../index.html#projects" class="text-slate-700 hover:text-sky-600 py-2 px-4 rounded-lg hover:bg-sky-50 transition-all">Projects</a>
                    <a href="../index.html#contact" class="text-slate-700 hover:text-sky-600 py-2 px-4 rounded-lg hover:bg-sky-50 transition-all">Contact</a>
                    <a href="../AnassOs.html" class="text-slate-700 hover:text-sky-600 py-2 px-4 rounded-lg hover:bg-sky-50 transition-all">AnassOS</a>
                    <a href="../Terminal.html" class="text-slate-700 hover:text-sky-600 py-2 px-4 rounded-lg hover:bg-sky-50 transition-all">Terminal</a>
                    <a href="../blog.html" class="text-sky-700 font-semibold py-2 px-4 rounded-lg bg-sky-50 transition-all">Blog</a>
                </div>
            </div>
        </nav>
    </header>
    <main class="pt-24 pb-16 bg-slate-50 min-h-screen">

    <!-- Hero / Meta -->
    <section class="article-hero border-b border-slate-200">
        <div class="max-w-6xl mx-auto px-6 py-10">
            <div class="flex flex-wrap items-center justify-between gap-4 mb-6 text-xs text-slate-500">
                <div class="flex items-center gap-3">
                    <a href="../../blog.html" class="inline-flex items-center text-slate-500 hover:text-sky-600">
                        <i class="fa-solid fa-arrow-left mr-2 text-xs"></i> Back to all posts
                    </a>
                    <span class="hidden sm:inline-block w-px h-4 bg-slate-300"></span>
                    <span class="inline-flex items-center gap-1">
                        <i class="fa-regular fa-calendar"></i>
                        <span id="post-date">2025-12-15</span>
                    </span>
                    <span class="inline-flex items-center gap-1">
                        <i class="fa-regular fa-clock"></i>
                        <span id="read-time">~5 min read</span>
                    </span>
                </div>
                <div class="flex flex-wrap gap-2">
                    <span class="px-3 py-1 bg-sky-100 text-sky-700 text-[11px] font-semibold badge-pill">
                        <i class="fa-solid fa-tag mr-1"></i> Homelab
                    </span>
                    <span class="px-3 py-1 bg-emerald-100 text-emerald-700 text-[11px] font-semibold badge-pill">
                        <i class="fa-solid fa-server mr-1"></i> Self-hosted
                    </span>
                    <span class="px-3 py-1 bg-amber-100 text-amber-700 text-[11px] font-semibold badge-pill">
                        <i class="fa-solid fa-cloud mr-1"></i> Cloudflare Tunnel
                    </span>
                    <span class="px-3 py-1 bg-slate-900 text-slate-100 text-[11px] font-semibold badge-pill">
                        <i class="fa-solid fa-user-gear mr-1"></i> Anass Assim
                    </span>
                </div>
            </div>

            <div class="grid lg:grid-cols-[1.6fr,1fr] gap-10 items-start">
                <div>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900 mb-4 leading-tight">
                        Homelab Docker Stack ‚Äì Turning an Old Laptop into a Cloudflare-Protected Lab
                    </h1>
                    <p class="text-slate-600 text-sm md:text-base max-w-2xl">
                        This post walks through my <strong>homelab</strong> stack: a headless Debian 13 server running
                        multiple self-hosted services (Nextcloud, Grafana, n8n, Portainer, filebrowser, code-server, nginx
                        dashboard and Cockpit) and publishing them <strong>securely through Cloudflare Tunnel</strong>
                        instead of opening ports on the router.
                    </p>
                    <p class="mt-2 text-[12px] text-amber-700 bg-amber-50 border border-amber-100 rounded-xl px-3 py-2 inline-flex items-start gap-2">
                        <i class="fa-solid fa-triangle-exclamation mt-0.5"></i>
                        <span>
                            All hostnames and secrets in the repo are placeholders.  
                            Replace them with your own domain and strong passwords before running this in the real world.
                        </span>
                    </p>
                </div>

                <!-- Meta JSON card -->
                <div class="relative rounded-2xl overflow-hidden border border-white shadow-xl bg-slate-900 text-slate-100">
                    <div class="px-4 py-2 flex items-center justify-between border-b border-slate-800">
                        <div class="flex items-center space-x-1.5">
                            <span class="w-2.5 h-2.5 rounded-full bg-red-500"></span>
                            <span class="w-2.5 h-2.5 rounded-full bg-yellow-500"></span>
                            <span class="w-2.5 h-2.5 rounded-full bg-green-500"></span>
                        </div>
                        <span class="text-[11px] text-slate-300">post_meta.json</span>
                        <i class="fa-solid fa-code text-[11px] text-slate-400"></i>
                    </div>
                    <div class="p-4 font-mono text-[11px] leading-relaxed">
<pre class="whitespace-pre-wrap"><code>{
  "title": "Homelab Docker Stack ‚Äì Debian 13 + Cloudflare Tunnel",
  "status": "published",
  "topics": ["homelab", "self-hosted", "cloudflare-tunnel"],
  "stack": [
    "Debian 13", "Docker", "Cloudflare Tunnel",
    "Nextcloud", "Grafana", "Portainer", "n8n", "Cockpit", "filebrowser", "code-server"
  ],
  "repo": "github.com/ciscoAnass/homelab",
  "location": "Seville, Spain"
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Article content + TOC + MUSIC PLAYER -->
    <section class="mt-8">
        <div class="max-w-6xl mx-auto px-6 flex flex-col lg:flex-row gap-10">

            <!-- Main article -->
            <article class="article-container mx-auto lg:mx-0 lg:flex-1">
                <div class="article-body text-sm md:text-[15px] text-slate-700 leading-relaxed" id="article-content">

                    <!-- 1 -->
                    <h2 id="intro" class="text-xl font-semibold text-slate-900">
                        1. Why This Homelab Exists ‚Äì One Laptop, Many Services, Zero Port Forwarding
                    </h2>
                    <p>
                        I had an ‚Äúold‚Äù laptop with a decent CPU and RAM lying around and wanted to turn it into something
                        actually useful: a <strong>24/7 homelab</strong> where I can run tools like Nextcloud,
                        Grafana or n8n without paying for a VPS every month.
                    </p>
                    <p>
                        The constraints:
                    </p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>No noisy GUI ‚Äì the machine lives in a corner, headless.</li>
                        <li>All services should be containerized using Docker Compose.</li>
                        <li>Remote access must be safe and simple, ideally without touching the ISP router.</li>
                        <li>Everything should be <strong>documented and reproducible</strong> so I can rebuild it later.</li>
                    </ul>
                    <p class="mt-3">
                        The result is this repo: a <strong>Docker-based homelab</strong> on Debian 13, with
                        <strong>Cloudflare Tunnel</strong> in front so I can expose selected services to the Internet
                        using subdomains like <code>grafana.example.com</code> or <code>cloud.example.com</code> ‚Äì no
                        open ports, no dynamic DNS drama.
                    </p>

                    <!-- 2 -->
                    <h2 id="hardware" class="mt-8 text-xl font-semibold text-slate-900">
                        2. Hardware & Base OS ‚Äì Free Performance on a ‚ÄúDead‚Äù Laptop
                    </h2>
                    <p>
                        The homelab runs on:
                    </p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li><strong>CPU:</strong> Intel i7-1255U (12th gen, mobile CPU).</li>
                        <li><strong>RAM:</strong> 24 GB DDR4, enough for multiple containers.</li>
                        <li><strong>Disk:</strong> NVMe SSD, hundreds of GB for data and images.</li>
                        <li><strong>GPU:</strong> Integrated graphics ‚Äì irrelevant for a headless server.</li>
                    </ul>
                    <p class="mt-3">
                        Operating system:
                    </p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li><strong>Debian 13</strong>, no desktop environment.</li>
                        <li>All management through SSH and web UIs (Portainer, Cockpit, Grafana, etc.).</li>
                    </ul>
                    <p class="mt-3">
                        On top of the base install, I added a toolbox of packages: Docker / Docker Compose,
                        programming runtimes (Python, Go, Node, Ruby), Tor, Cockpit, and Cloudflare‚Äôs
                        <code>cloudflared</code> for tunnels. The goal is to be able to spin up almost anything from this
                        one box.
                    </p>

                    <!-- Repo structure -->
                    <h3 class="mt-6 text-base font-semibold text-slate-900">
                        2.1 Repository Layout
                    </h3>
                    <p>
                        The repo mirrors the way the homelab is organized:
                    </p>

<pre class="code-block mt-3"><code>homelab/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ cloudflared/
‚îÇ   ‚îî‚îÄ‚îÄ config.yml              # Cloudflare Tunnel config (example)
‚îî‚îÄ‚îÄ docker/
    ‚îú‚îÄ‚îÄ code-server/
    ‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml  # VS Code in browser
    ‚îú‚îÄ‚îÄ filebrowser/
    ‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml  # Web file manager
    ‚îú‚îÄ‚îÄ grafana/
    ‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml  # Dashboards
    ‚îú‚îÄ‚îÄ n8n/
    ‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml  # Automation
    ‚îú‚îÄ‚îÄ nextcloud/
    ‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml  # Cloud storage + MariaDB + Adminer
    ‚îú‚îÄ‚îÄ nginx/
    ‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml  # Simple dashboard
    ‚îî‚îÄ‚îÄ portainer/
        ‚îî‚îÄ‚îÄ docker-compose.yml  # Docker management UI</code></pre>

                    <p class="mt-3">
                        Each service is isolated in its own folder so you can start, stop and tweak them independently.
                    </p>

                    <!-- 3 -->
                    <h2 id="services" class="mt-8 text-xl font-semibold text-slate-900">
                        3. Docker Services ‚Äì The Core Apps of the Homelab
                    </h2>
                    <p>
                        Let‚Äôs look at what actually runs on the server and how each piece fits in.
                    </p>

                    <h3 class="mt-4 text-base font-semibold text-slate-900">
                        3.1 code-server ‚Äì VS Code in the Browser
                    </h3>
                    <p>
                        I use <strong>code-server</strong> as a browser-based VS Code instance:
                    </p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>Port: <code>8443</code> on the host.</li>
                        <li>Workspace mapped from a host folder (for example <code>/home/anass24/code</code>).</li>
                        <li>Password protection via an env variable in the compose file.</li>
                    </ul>

<pre class="code-block mt-3"><code>cd docker/code-server
docker compose up -d</code></pre>

                    <p class="mt-3">
                        Locally I hit <code>https://&lt;server-ip&gt;:8443</code>. Remotely I go through
                        <code>code.example.com</code> routed by Cloudflare Tunnel.
                    </p>

                    <h3 class="mt-6 text-base font-semibold text-slate-900">
                        3.2 filebrowser ‚Äì Web File Manager for /data
                    </h3>
                    <p>
                        <strong>filebrowser</strong> gives me a lightweight file manager:
                    </p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>Port: <code>8082</code>.</li>
                        <li>Host data root: <code>/data</code>.</li>
                        <li>Its own DB stored inside <code>/data/filebrowser</code>.</li>
                    </ul>

<pre class="code-block mt-3"><code>cd docker/filebrowser
docker compose up -d

# Local:    http://&lt;server-ip&gt;:8082
# Remote:   files.example.com via Cloudflare</code></pre>

                    <h3 class="mt-6 text-base font-semibold text-slate-900">
                        3.3 Grafana ‚Äì Metrics and Dashboards
                    </h3>
                    <p>
                        <strong>Grafana</strong> is my main dashboard layer:
                    </p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>Port: <code>3000</code>.</li>
                        <li>Data stored in a named Docker volume (e.g. <code>grafana_data</code>).</li>
                        <li>Usually paired with Prometheus (not shown here) for metrics.</li>
                    </ul>

<pre class="code-block mt-3"><code>cd docker/grafana
docker compose up -d

# Local:  http://&lt;server-ip&gt;:3000
# Remote: grafana.example.com</code></pre>

                    <h3 class="mt-6 text-base font-semibold text-slate-900">
                        3.4 n8n ‚Äì Automation Workbench
                    </h3>
                    <p>
                        <strong>n8n</strong> runs as my low-code automation hub:
                    </p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>Port: <code>5678</code>.</li>
                        <li>Persistent data under <code>/data/n8n</code> on the host.</li>
                        <li>Timezone set to <code>Europe/Madrid</code> so crons and timestamps match my life.</li>
                    </ul>

<pre class="code-block mt-3"><code>cd docker/n8n
docker compose up -d

# Local:  http://&lt;server-ip&gt;:5678
# Remote: n8n.example.com</code></pre>

                    <p class="mt-3">
                        In development I keep <code>N8N_SECURE_COOKIE=false</code> to avoid cookie issues behind plain
                        HTTP, then switch to <code>true</code> once everything sits behind HTTPS.
                    </p>

                    <h3 class="mt-6 text-base font-semibold text-slate-900">
                        3.5 Nextcloud Stack ‚Äì Files + MariaDB + Adminer
                    </h3>
                    <p>
                        The Nextcloud stack bundles three containers:
                    </p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li><strong>mariadb</strong> ‚Äì database.</li>
                        <li><strong>nextcloud</strong> ‚Äì main web app.</li>
                        <li><strong>adminer</strong> ‚Äì tiny DB management UI.</li>
                    </ul>
                    <p class="mt-3">
                        Ports:
                    </p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>Nextcloud: <code>8081</code>.</li>
                        <li>Adminer: <code>8083</code>.</li>
                        <li>MariaDB (internal): <code>3306</code>.</li>
                    </ul>

<pre class="code-block mt-3"><code>cd docker/nextcloud
docker compose up -d

# Local:
#   Nextcloud: http://&lt;server-ip&gt;:8081
#   Adminer:   http://&lt;server-ip&gt;:8083 (server: mariadb)</code></pre>

                    <p class="mt-3">
                        Before first start I always go through the compose file and replace all the
                        <code>CHANGE_ME_...</code> values: DB root password, Nextcloud admin credentials, trusted
                        domains and so on.
                    </p>

                    <h3 class="mt-6 text-base font-semibold text-slate-900">
                        3.6 nginx Dashboard ‚Äì Simple Landing Page for the Lab
                    </h3>
                    <p>
                        A tiny <strong>nginx</strong> container serves a static dashboard:
                    </p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>Port: <code>8080</code>.</li>
                        <li>Root file: <code>docker/nginx/index.html</code>.</li>
                    </ul>

<pre class="code-block mt-3"><code>cd docker/nginx
# put your dashboard HTML into docker/nginx/index.html
docker compose up -d

# Local:  http://&lt;server-ip&gt;:8080
# Remote: dashboard.example.com</code></pre>

                    <p class="mt-3">
                        That index page is just a clean landing page with links to everything: Nextcloud, filebrowser,
                        Grafana, n8n, Portainer, Cockpit‚Ä¶ basically a control panel for the homelab.
                    </p>

                    <h3 class="mt-6 text-base font-semibold text-slate-900">
                        3.7 Portainer ‚Äì Docker Management UI
                    </h3>
                    <p>
                        <strong>Portainer</strong> gives me a visual way to inspect containers, volumes and networks:
                    </p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>HTTP: <code>9000</code>, HTTPS: <code>9443</code>.</li>
                        <li>Mounts the Docker socket to control the local engine.</li>
                        <li>Stores its data in a named volume (e.g. <code>portainer_data</code>).</li>
                    </ul>

<pre class="code-block mt-3"><code>cd docker/portainer
docker compose up -d

# Local:
#   http://&lt;server-ip&gt;:9000
#   https://&lt;server-ip&gt;:9443
# Remote:
#   docker.example.com (via Cloudflare)</code></pre>

                    <h3 class="mt-6 text-base font-semibold text-slate-900">
                        3.8 Cockpit ‚Äì Host-Level Web UI
                    </h3>
                    <p>
                        <strong>Cockpit</strong> is installed directly on Debian (not as a container). It runs on a
                        custom port (for example <code>9091</code>) and gives a nice web view over systemd services,
                        logs and storage.
                    </p>
                    <p class="mt-3">
                        It‚Äôs also exposed through Cloudflare Tunnel as <code>cockpit.example.com</code>, but locked
                        behind strong authentication.
                    </p>

                    <!-- 4 -->
                    <h2 id="cloudflare" class="mt-8 text-xl font-semibold text-slate-900">
                        4. Cloudflare Tunnel ‚Äì Publishing Services Without Opening Ports
                    </h2>
                    <p>
                        Instead of forwarding ports from my home router, I use a single <strong>Cloudflare Tunnel</strong>
                        that connects the server to Cloudflare‚Äôs edge. From there, subdomains on my zone are mapped to
                        local services.
                    </p>

                    <h3 class="mt-4 text-base font-semibold text-slate-900">
                        4.1 Example <code>cloudflared/config.yml</code>
                    </h3>
                    <p>
                        The config file defines the tunnel ID and the ingress rules:
                    </p>

<pre class="code-block mt-3"><code>loglevel: info
tunnel: &lt;YOUR_TUNNEL_ID&gt;
credentials-file: /root/.cloudflared/&lt;YOUR_TUNNEL_ID&gt;.json

ingress:
  - hostname: grafana.example.com
    service: http://localhost:3000
  - hostname: n8n.example.com
    service: http://localhost:5678
  - hostname: cloud.example.com
    service: http://localhost:8081
  - hostname: files.example.com
    service: http://localhost:8082
  - hostname: sql.example.com
    service: http://localhost:8083
  - hostname: code.example.com
    service: http://localhost:8443
  - hostname: docker.example.com
    service: http://localhost:9000
  - hostname: cockpit.example.com
    service: http://localhost:9091
  - hostname: dashboard.example.com
    service: http://localhost:8080
  - service: http_status:404</code></pre>

                    <p class="mt-3">
                        Each subdomain points to a port on <code>localhost</code>. Cloudflare handles TLS certificates
                        and DNS; the server only needs to talk plain HTTP on the LAN side.
                    </p>

                    <h3 class="mt-6 text-base font-semibold text-slate-900">
                        4.2 Creating the Tunnel and DNS Routes
                    </h3>
                    <p>
                        The basic flow:
                    </p>

<pre class="code-block mt-3"><code># 1) Login (opens browser)
cloudflared tunnel login

# 2) Create a tunnel
cloudflared tunnel create homelab

# 3) List and grab the ID
cloudflared tunnel list</code></pre>

                    <p class="mt-3">
                        After updating <code>config.yml</code> with the tunnel ID, I link each hostname with the tunnel:
                    </p>

<pre class="code-block mt-3"><code>cloudflared tunnel route dns homelab grafana.example.com
cloudflared tunnel route dns homelab n8n.example.com
cloudflared tunnel route dns homelab cloud.example.com
cloudflared tunnel route dns homelab files.example.com
cloudflared tunnel route dns homelab sql.example.com
cloudflared tunnel route dns homelab code.example.com
cloudflared tunnel route dns homelab docker.example.com
cloudflared tunnel route dns homelab cockpit.example.com
cloudflared tunnel route dns homelab dashboard.example.com</code></pre>

                    <h3 class="mt-6 text-base font-semibold text-slate-900">
                        4.3 Running <code>cloudflared</code> as a Service
                    </h3>
                    <p>
                        Finally I install it as a system service so the tunnel starts on boot:
                    </p>

<pre class="code-block mt-3"><code>sudo cloudflared service install
sudo systemctl enable cloudflared
sudo systemctl start cloudflared
sudo systemctl status cloudflared</code></pre>

                    <p class="mt-3">
                        From that point on, the homelab behaves like a mini SaaS environment behind my own domain, but
                        with zero open ports and full control.
                    </p>

                    <!-- 5 -->
                    <h2 id="bootstrap" class="mt-8 text-xl font-semibold text-slate-900">
                        5. From Fresh Debian to Full Homelab ‚Äì Bootstrap Checklist
                    </h2>
                    <p>
                        If I had to rebuild this homelab from scratch on a new machine, this would be the order:
                    </p>

                    <ol class="list-decimal pl-6 space-y-1">
                        <li>Install Debian 13 (minimal), enable SSH.</li>
                        <li>Install system tools, Docker / Compose, Tor, Cockpit, <code>cloudflared</code> and runtimes
                            (Python, Go, Node, Ruby).
                        </li>
                        <li>Create base directories:
                            <ul class="list-disc pl-6 mt-1">
                                <li><code>/data</code> (root for shared storage).</li>
                                <li>Subfolders like <code>/data/filebrowser</code>, <code>/data/nextcloud</code>,
                                    <code>/data/mariadb</code>, <code>/data/n8n</code>.
                                </li>
                                <li>A code workspace folder, e.g. <code>/home/&lt;user&gt;/code</code>.</li>
                            </ul>
                        </li>
                        <li>Clone the repo onto the server:
<pre class="code-block mt-2"><code>git clone https://github.com/ciscoAnass/homelab.git
cd homelab</code></pre>
                        </li>
                        <li>Edit all compose files and replace:
                            <ul class="list-disc pl-6 mt-1">
                                <li><code>CHANGE_ME_...</code> values with strong passwords.</li>
                                <li><code>example.com</code> with your real domain.</li>
                            </ul>
                        </li>
                        <li>Bring up each Docker stack:
<pre class="code-block mt-2"><code>cd docker/&lt;service&gt;
docker compose up -d</code></pre>
                        </li>
                        <li>Configure Cloudflare Tunnel and DNS mappings using <code>cloudflared/config.yml</code>.</li>
                        <li>Harden access with Cloudflare Zero Trust / Access, strong passwords and regular updates.</li>
                    </ol>

                    <!-- 6 -->
                    <h2 id="security" class="mt-8 text-xl font-semibold text-slate-900">
                        6. Security Checklist & Next Steps
                    </h2>
                    <p>
                        Even for a personal homelab, I treat this like a small production system. A few rules I follow:
                    </p>

                    <h3 class="mt-4 text-base font-semibold text-slate-900">
                        6.1 Security Checklist
                    </h3>
                    <ul class="list-disc pl-6 space-y-1">
                        <li><strong>Passwords:</strong> never run with the default placeholder secrets ‚Äì rotate everything before the first <code>docker compose up</code>.</li>
                        <li><strong>Domains:</strong> stick to a dedicated domain or subdomain only for the homelab; don‚Äôt mix it with random personal sites.</li>
                        <li><strong>Cloudflare Access:</strong> gate sensitive UIs (Portainer, Cockpit, n8n) with SSO / MFA if possible.</li>
                        <li><strong>Updates:</strong> regularly patch Debian and refresh containers:
                            <ul class="list-disc pl-6 mt-1">
                                <li><code>sudo apt update &amp;&amp; sudo apt upgrade</code></li>
                                <li>Pull new images and <code>docker compose up -d</code> again.</li>
                            </ul>
                        </li>
                        <li><strong>Backups:</strong> back up:
                            <ul class="list-disc pl-6 mt-1">
                                <li><code>/data</code> (Nextcloud files, DBs, n8n data, filebrowser DB).</li>
                                <li>Named volumes like <code>grafana_data</code>, <code>portainer_data</code>.</li>
                            </ul>
                        </li>
                    </ul>

                    <h3 class="mt-6 text-base font-semibold text-slate-900">
                        6.2 What I Want to Add Next
                    </h3>
                    <ul class="list-disc pl-6 space-y-1">
                        <li><strong>Central monitoring:</strong> Prometheus + Loki + Grafana for logs and metrics from all containers.</li>
                        <li><strong>Offsite backups:</strong> encrypted snapshots to another location (cloud or a friend‚Äôs server).</li>
                        <li><strong>More services:</strong> Jellyfin for media, a password manager vault, maybe a small Kubernetes lab.</li>
                        <li><strong>IaC:</strong> move more of this setup to Ansible / Terraform to recreate the homelab automatically.</li>
                    </ul>

                    <p class="mt-3">
                        For now, this homelab is exactly what I wanted: a single Debian box that behaves like my own
                        little datacenter, exposed safely through Cloudflare and defined as code inside one public repo.
                    </p>

                    <div class="mt-8 p-4 rounded-2xl border border-sky-100 bg-sky-50/60 text-sm text-slate-700">
                        <p class="font-semibold text-slate-900 mb-1">
                            üí¨ Want to discuss homelabs or this stack?
                        </p>
                        <p>
                            Reach out on LinkedIn or send me an email. I‚Äôm always happy to talk about homelab design,
                            Cloudflare Tunnel, and self-hosting workflows on low-power hardware.
                        </p>
                    </div>
                </div>

                <!-- Bottom meta -->
                <div class="mt-10 flex flex-wrap items-center justify-between gap-4 text-xs text-slate-500">
                    <div class="flex flex-wrap gap-2">
                        <span class="px-3 py-1 bg-slate-900 text-slate-100 badge-pill">
                            <i class="fa-solid fa-hashtag mr-1"></i> homelab
                        </span>
                        <span class="px-3 py-1 bg-sky-100 text-sky-700 badge-pill">
                            self-hosted
                        </span>
                        <span class="px-3 py-1 bg-emerald-100 text-emerald-700 badge-pill">
                            docker
                        </span>
                        <span class="px-3 py-1 bg-indigo-100 text-indigo-700 badge-pill">
                            cloudflare-tunnel
                        </span>
                        <span class="px-3 py-1 bg-amber-100 text-amber-700 badge-pill">
                            debian-13
                        </span>
                    </div>
                    <button id="copy-link-btn"
                            class="inline-flex items-center px-3 py-2 border border-slate-200 rounded-xl text-[11px] hover:bg-slate-100 transition">
                        <i class="fa-solid fa-link mr-2 text-slate-500"></i>
                        Copy article link
                    </button>
                </div>
            </article>

            <!-- Sidebar: Music player + Guide map + Author -->
            <aside class="lg:w-72 lg:flex-shrink-0">
                <div class="sticky top-28 space-y-6">

                    <!-- MUSIC PLAYER (SIDEBAR) -->
                    <div class="reading-music-card p-4 text-slate-50">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-11 h-11 rounded-2xl bg-slate-800 border border-slate-700 flex items-center justify-center shadow-inner">
                                    <i class="fa-solid fa-music text-sky-400 text-sm"></i>
                                </div>
                                <div class="space-y-0.5">
                                    <p class="text-[10px] uppercase tracking-[0.18em] text-slate-400">
                                        Reading soundtrack
                                    </p>
                                    <p class="text-xs font-semibold text-slate-50">
                                        Homelab Nights ‚Äì Focus Mix
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center justify-between mb-2">
                            <button id="play-pause-btn"
                                    class="player-btn w-9 h-9 rounded-full bg-sky-500 hover:bg-sky-400 flex items-center justify-center border border-sky-300 shadow">
                                <i id="play-pause-icon" class="fa-solid fa-play text-[11px] text-slate-950 ml-0.5"></i>
                            </button>
                            <div class="flex items-center gap-2 text-[10px] text-slate-300">
                                <span id="player-current-time">0:00</span>
                                <span class="text-slate-600">/</span>
                                <span id="player-duration">0:00</span>
                            </div>
                        </div>

                        <div class="player-progress-track rounded-full overflow-hidden" id="player-progress-track">
                            <div class="player-progress-fill" id="player-progress"></div>
                        </div>

                        <p class="mt-2 text-[10px] text-slate-400">
                            Optional: hit play while you SSH into Debian, tweak Docker Compose files and wire Cloudflare.
                        </p>

                        <audio id="reading-audio" src="/assets/mp3/reading.mp3" preload="metadata"></audio>
                    </div>

                    <!-- Guide Map (replaces "On this page") -->
                    <div class="bg-white/95 border border-slate-200 rounded-2xl shadow-md p-5">
                        <h3 class="text-sm font-semibold text-slate-700 uppercase tracking-[0.18em] mb-3 flex items-center gap-2">
                            <span class="inline-flex w-6 h-6 rounded-full bg-sky-100 text-sky-600 items-center justify-center text-xs">
                                <i class="fa-solid fa-route"></i>
                            </span>
                            Homelab Guide Map
                        </h3>

                        <nav class="space-y-1.5 text-[13px] md:text-sm">
                            <a href="#intro"
                               class="toc-link flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-50 hover:text-slate-900 transition">
                                <span class="w-1.5 h-1.5 rounded-full bg-sky-400"></span>
                                <div class="flex flex-col leading-tight">
                                    <span class="font-semibold">1. Why this homelab</span>
                                    <span class="text-[11px] text-slate-500">Laptop ‚Üí mini datacenter</span>
                                </div>
                            </a>

                            <a href="#hardware"
                               class="toc-link flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-50 hover:text-slate-900 transition">
                                <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>
                                <div class="flex flex-col leading-tight">
                                    <span class="font-semibold">2. Hardware & OS</span>
                                    <span class="text-[11px] text-slate-500">Debian 13, /data layout</span>
                                </div>
                            </a>

                            <a href="#services"
                               class="toc-link flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-50 hover:text-slate-900 transition">
                                <span class="w-1.5 h-1.5 rounded-full bg-indigo-400"></span>
                                <div class="flex flex-col leading-tight">
                                    <span class="font-semibold">3. Docker services</span>
                                    <span class="text-[11px] text-slate-500">Nextcloud, Grafana, n8n, etc.</span>
                                </div>
                            </a>

                            <a href="#cloudflare"
                               class="toc-link flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-50 hover:text-slate-900 transition">
                                <span class="w-1.5 h-1.5 rounded-full bg-amber-400"></span>
                                <div class="flex flex-col leading-tight">
                                    <span class="font-semibold">4. Cloudflare Tunnel</span>
                                    <span class="text-[11px] text-slate-500">Subdomains & ingress rules</span>
                                </div>
                            </a>

                            <a href="#bootstrap"
                               class="toc-link flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-50 hover:text-slate-900 transition">
                                <span class="w-1.5 h-1.5 rounded-full bg-rose-400"></span>
                                <div class="flex flex-col leading-tight">
                                    <span class="font-semibold">5. Bootstrap steps</span>
                                    <span class="text-[11px] text-slate-500">Fresh Debian ‚Üí full stack</span>
                                </div>
                            </a>

                            <a href="#security"
                               class="toc-link flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-50 hover:text-slate-900 transition">
                                <span class="w-1.5 h-1.5 rounded-full bg-slate-400"></span>
                                <div class="flex flex-col leading-tight">
                                    <span class="font-semibold">6. Security & roadmap</span>
                                    <span class="text-[11px] text-slate-500">Hardening & future ideas</span>
                                </div>
                            </a>
                        </nav>
                    </div>

                    <!-- Author card -->
                    <div class="bg-slate-900 text-slate-50 rounded-2xl p-4 flex items-center gap-3 shadow-md">
                        <img src="/assets/img/anass4.png"
                             alt="Anass"
                             class="w-12 h-12 rounded-full border-2 border-sky-400 object-cover">
                        <div class="text-xs">
                            <p class="font-semibold">Written by Anass Assim</p>
                            <p class="text-slate-300">
                                DevOps Junior &amp; SysAdmin based in Seville.  
                                Loves turning old hardware into useful, well-documented infrastructure.
                            </p>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </section>
</main>



    <!-- Footer -->
    <footer class="py-12 bg-slate-900 text-white mt-10">
        <div class="max-w-6xl mx-auto px-6">
            <div class="text-center">
                <div class="mb-8">
                    <h3 class="text-2xl font-bold mb-4">Anass Assim</h3>
                    <p class="text-slate-400 max-w-md mx-auto">
                        DevOps Junior & System Administrator passionate about creating efficient, scalable solutions.
                    </p>
                </div>

                <div class="flex justify-center space-x-6 mb-8">
                    <a href="https://www.linkedin.com/in/anass-assim/" class="magnetic text-slate-400 hover:text-white text-2xl transition-all duration-300 transform hover:scale-125" target="_blank">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="https://github.com/ciscoAnass" class="magnetic text-slate-400 hover:text-white text-2xl transition-all duration-300 transform hover:scale-125" target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="https://x.com/ciscoAnass" class="magnetic text-slate-400 hover:text-white text-2xl transition-all duration-300 transform hover:scale-125" target="_blank">
                        <i class="fa-brands fa-x-twitter"></i>
                    </a>
                    <a href="mailto:anass.assim.2010@gmail.com" class="magnetic text-slate-400 hover:text-white text-2xl transition-all duration-300 transform hover:scale-125" target="_blank">
                        <i class="fas fa-envelope"></i>
                    </a>    
                </div>

                <div class="border-t border-slate-800 pt-8">
                    <p class="text-slate-400 text-sm">
                        &copy; <span id="currentYear">2025</span> Anass Assim. All rights reserved.
                    </p>
                    <p class="text-slate-500 text-xs mt-2">
                        Built with passion using modern web technologies
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Inline JS -->
    <script>
        // Scroll indicator
        const scrollBar = document.querySelector('.scroll-indicator');
        window.addEventListener('scroll', () => {
            const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const progress = (scrollTop / scrollHeight) * 100;
            scrollBar.style.width = progress + '%';
        });

        // Header shadow
        const navbar = document.getElementById('navbar');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 40) {
                navbar.classList.add('shadow-lg', 'bg-white/90');
            } else {
                navbar.classList.remove('shadow-lg', 'bg-white/90');
            }
        });

        // Mobile menu
        const mobileBtn = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileBtn.addEventListener('click', () => {
            const hidden = mobileMenu.classList.contains('hidden');
            mobileMenu.classList.toggle('hidden');
            mobileBtn.setAttribute('aria-expanded', String(hidden));
        });

        // Dynamic year
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // Copy link
        const copyBtn = document.getElementById('copy-link-btn');
        copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(window.location.href);
                copyBtn.innerHTML = '<i class="fa-solid fa-check mr-2 text-emerald-500"></i> Link copied!';
                setTimeout(() => {
                    copyBtn.innerHTML = '<i class="fa-solid fa-link mr-2 text-slate-500"></i>Copy article link';
                }, 2000);
            } catch (e) {
                console.error(e);
            }
        });

        // TOC active highlighting
        const tocLinks = document.querySelectorAll('.toc-link');
        const headings = [...document.querySelectorAll('#article-content h2, #article-content h3')];

        const tocObserver = new IntersectionObserver(
            (entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.id;
                        tocLinks.forEach(link => {
                            link.classList.toggle('active', link.getAttribute('href') === '#' + id);
                        });
                    }
                });
            },
            { rootMargin: "0px 0px -60% 0px", threshold: 0.1 }
        );

        headings.forEach(h => tocObserver.observe(h));

        // Magnetic effect
        document.querySelectorAll('.magnetic').forEach(el => {
            el.addEventListener('mousemove', (e) => {
                const rect = el.getBoundingClientRect();
                const x = (e.clientX - rect.left - rect.width / 2) / 20;
                const y = (e.clientY - rect.top - rect.height / 2) / 20;
                el.style.transform = `translate(${x}px, ${y}px) scale(1.1)`;
            });
            el.addEventListener('mouseleave', () => {
                el.style.transform = 'translate(0, 0) scale(1)';
            });
        });

        // Simple reading-time estimate based on content length
        (function computeReadTime() {
            const text = document.getElementById('article-content').innerText || '';
            const words = text.trim().split(/\s+/).length;
            const minutes = Math.max(1, Math.round(words / 200)); // ~200 wpm
            document.getElementById('read-time').textContent = `~${minutes} min read`;
        })();

        // MUSIC PLAYER LOGIC
        const audio = document.getElementById('reading-audio');
        const playBtn = document.getElementById('play-pause-btn');
        const playIcon = document.getElementById('play-pause-icon');
        const progressTrack = document.getElementById('player-progress-track');
        const progressFill = document.getElementById('player-progress');
        const currentTimeEl = document.getElementById('player-current-time');
        const durationEl = document.getElementById('player-duration');

        function formatTime(sec) {
            if (isNaN(sec) || sec === Infinity) return "0:00";
            const minutes = Math.floor(sec / 60);
            const seconds = Math.floor(sec % 60);
            return minutes + ":" + String(seconds).padStart(2, '0');
        }

        if (audio) {
            audio.addEventListener('loadedmetadata', () => {
                durationEl.textContent = formatTime(audio.duration);
            });

            audio.addEventListener('timeupdate', () => {
                currentTimeEl.textContent = formatTime(audio.currentTime);
                if (audio.duration) {
                    const percent = (audio.currentTime / audio.duration) * 100;
                    progressFill.style.width = percent + '%';
                }
            });

            audio.addEventListener('ended', () => {
                playIcon.classList.remove('fa-pause');
                playIcon.classList.add('fa-play');
            });

            playBtn.addEventListener('click', () => {
                if (audio.paused) {
                    audio.play().catch(err => console.error(err));
                    playIcon.classList.remove('fa-play');
                    playIcon.classList.add('fa-pause');
                } else {
                    audio.pause();
                    playIcon.classList.remove('fa-pause');
                    playIcon.classList.add('fa-play');
                }
            });

            progressTrack.addEventListener('click', (e) => {
                const rect = progressTrack.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const ratio = clickX / rect.width;
                if (audio.duration) {
                    audio.currentTime = Math.min(Math.max(ratio * audio.duration, 0), audio.duration);
                }
            });
        }
    </script>
</body>
</html>
